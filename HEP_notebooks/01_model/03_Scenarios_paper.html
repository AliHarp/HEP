

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scenario analysis for BMJ Open paper &#8212; Hospital Efficiency Project Orthopaedic Planning Model</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'HEP_notebooks/01_model/03_Scenarios_paper';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fitting LoS distributions for HEP" href="04_HEP_fit_dists.html" />
    <link rel="prev" title="Scenario Testing" href="02_Scenario_testing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../01_intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/HdRlogo.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/HdRlogo.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../01_intro.html">
                    Hospital Efficiency Project
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">RUNNING THE MODEL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_HEP_main.html">Model</a></li>



<li class="toctree-l1"><a class="reference internal" href="02_Scenario_testing.html">Scenario Testing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Scenario analysis for BMJ Open paper</a></li>

<li class="toctree-l1"><a class="reference internal" href="04_HEP_fit_dists.html">Fitting LoS distributions for HEP</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">REPORTING GUIDELINES</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_STRESS/STRESS_DES.html">STRESS-DES</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/AliHarp/HEP/main?urlpath=lab/tree/HEP_notebooks/01_model/03_Scenarios_paper.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/AliHarp/HEP" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AliHarp/HEP/issues/new?title=Issue%20on%20page%20%2FHEP_notebooks/01_model/03_Scenarios_paper.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/HEP_notebooks/01_model/03_Scenarios_paper.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Scenario analysis for BMJ Open paper</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Scenario analysis for BMJ Open paper</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenarios">Scenarios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-schedule-with-weekend-activity-for-scenarios">Create schedule with weekend activity for scenarios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#save-results">SAVE RESULTS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-output-description">Scenario output description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#throughput">Throughput</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lost-slots">Lost slots</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="scenario-analysis-for-bmj-open-paper">
<h1>Scenario analysis for BMJ Open paper<a class="headerlink" href="#scenario-analysis-for-bmj-open-paper" title="Permalink to this headline">#</a></h1>
<p>Multiway sensitivity analyses to test the impact of varying parameters on the key performance measures (bed utilisation, lost slots, and total surgical throughput).</p>
<section id="scenarios">
<h2>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">#</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for beds 30 : 80 (5):
    for schedule (baseline : baseline+weekend):

        baseline los ; baseline prop delay  

        baseline los ; 0.25* prop delay  

        0.25* los ; baseline prop delay  

        0.25* los ; 0.25* prop delay  
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">simpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">model2</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">kaleido</span>
<span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-schedule-with-weekend-activity-for-scenarios">
<h2>Create schedule with weekend activity for scenarios<a class="headerlink" href="#create-schedule-with-weekend-activity-for-scenarios" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DEFAULT_PRIMARY_DICT = {1: &#39;p_hip&#39;, 2: &#39;p_knee&#39;, 3: &#39;uni_knee&#39;}</span>
<span class="c1"># DEFAULT_REVISION_DICT = {1: &#39;r_hip&#39;, 2: &#39;r_knee&#39;}</span>
<span class="c1"># DEFAULT_PRIMARY_PROB = [0.51, 0.38, 0.11]</span>
<span class="c1"># DEFAULT_REVISION_PROB = [0.55, 0.45]</span>

<span class="c1"># SET_WEEKDAY = [&#39;Monday&#39;, &#39;Tuesday&#39;, &#39;Wednesday&#39;, &#39;Thursday&#39;,</span>
<span class="c1">#                &#39;Friday&#39;, &#39;Saturday&#39;, &#39;Sunday&#39;]</span>
<span class="c1"># SET_SESSIONS_PER_WEEKDAY = {&#39;Monday&#39;: 3, &#39;Tuesday&#39;: 3, &#39;Wednesday&#39;: 3, &#39;Thursday&#39;: 3,</span>
<span class="c1">#                             &#39;Friday&#39;: 3, &#39;Saturday&#39;: 3, &#39;Sunday&#39;: 3}</span>
<span class="c1"># SET_SESSIONS_PER_WEEKDAY_LIST = list(SET_SESSIONS_PER_WEEKDAY.values())</span>
<span class="c1"># SET_ALLOCATION = {&#39;Monday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Tuesday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Wednesday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Thursday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Friday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Saturday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;],</span>
<span class="c1">#                   &#39;Sunday&#39;: [&#39;2P_or_1R&#39;, &#39;2P_or_1R&#39;, &#39;1P&#39;]}</span>
<span class="c1"># SET_THEATRES_PER_WEEKDAY = {&#39;Monday&#39;: 4, &#39;Tuesday&#39;: 4, &#39;Wednesday&#39;: 4, &#39;Thursday&#39;: 4,</span>
<span class="c1">#                             &#39;Friday&#39;: 4, &#39;Saturday&#39;: 4, &#39;Sunday&#39;: 4}</span>

<span class="c1"># DEFAULT_RESULTS_COLLECTION_PERIOD = 70</span>
<span class="c1"># DEFAULT_WARM_UP_PERIOD = 35</span>
<span class="c1"># DEFAULT_NUMBER_OF_RUNS = 50</span>

<span class="c1"># class Schedule:</span>
        
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Creates theatre schedule according to rules</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def __init__(self, weekday=SET_WEEKDAY,</span>
<span class="c1">#                 allocation=SET_ALLOCATION,</span>
<span class="c1">#                 sessions_per_weekday=SET_SESSIONS_PER_WEEKDAY,</span>
<span class="c1">#                 sessions_per_weekday_list=SET_SESSIONS_PER_WEEKDAY_LIST,</span>
<span class="c1">#                 theatres_per_weekday=SET_THEATRES_PER_WEEKDAY):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         parameters used to create schedule defined in &#39;scenarios class&#39;</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         self.weekday=weekday</span>
<span class="c1">#         self.allocation=allocation</span>
<span class="c1">#         self.sessions_per_weekday=sessions_per_weekday</span>
<span class="c1">#         self.sessions_per_weekday_list=sessions_per_weekday_list</span>
<span class="c1">#         self.theatres_per_weekday=theatres_per_weekday</span>
        
<span class="c1">#     def create_schedule(self,weekday, sessions_per_weekday_list, allocation, theatres_per_weekday):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         Arguments needed:</span>
<span class="c1">#             *weekday: a list of weekdays</span>
<span class="c1">#             *sessions_per_weekday: a list of integers representing the number of sessions per weekday</span>
<span class="c1">#             *allocation: a dictionary where the keys are the weekdays and the values are lists of </span>
<span class="c1">#                         allocations for each session </span>
<span class="c1">#             *theatres_per_weekday: a dictionary where the keys are the weekdays and the values are </span>
<span class="c1">#                         integers representing the number of theatres per weekday </span>
<span class="c1">#         Returns a dictionary where the keys are the weekdays and the values are lists </span>
<span class="c1">#                         of lists of allocations for each theatre for each session.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         schedule = {}</span>
<span class="c1">#         for day, num_sessions in zip(weekday, sessions_per_weekday_list):</span>
<span class="c1">#             schedule[day] = []</span>
<span class="c1">#             for theatre in range(theatres_per_weekday[day]):</span>
<span class="c1">#                 schedule[day].append([])</span>
<span class="c1">#                 for session in range(num_sessions):</span>
<span class="c1">#                     if allocation[day][session] == &#39;1P&#39;:</span>
<span class="c1">#                         schedule[day][theatre].append({&#39;primary&#39;: 1})</span>
<span class="c1">#                     elif allocation[day][session] == &#39;1R&#39;:</span>
<span class="c1">#                         schedule[day][theatre].append({&#39;revision&#39;: 1})</span>
<span class="c1">#                     elif allocation[day][session] == &#39;2P&#39;:</span>
<span class="c1">#                         schedule[day][theatre].append({&#39;primary&#39;: 2})</span>
<span class="c1">#                     elif allocation[day][session] == &#39;2P_or_1R&#39;:</span>
<span class="c1">#                         if random.random() &gt; 0.5:</span>
<span class="c1">#                             schedule[day][theatre].append({&#39;primary&#39;: 2})</span>
<span class="c1">#                         else:</span>
<span class="c1">#                             schedule[day][theatre].append({&#39;revision&#39;: 1})</span>
<span class="c1">#         return schedule</span>
        
<span class="c1">#     def daily_counts(self,day_data):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         day_data: called in week_schedule() function, day_data is a sample weekly dictionary from create_schedule()</span>
<span class="c1">#         Convert dict to a pandas DataFrame with &#39;primary&#39; and &#39;revision&#39; as columns </span>
<span class="c1">#         and days of the week as the index, populated with the total count of &#39;primary&#39; and &#39;revision&#39; in each day.</span>
<span class="c1">#         Returns a one week schedule</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         #day_data = create_schedule(weekday, sessions_per_weekday, allocation, theatres_per_weekday)</span>
<span class="c1">#         primary_slots = 0</span>
<span class="c1">#         revision_slots = 0</span>
<span class="c1">#         for value in day_data:</span>
<span class="c1">#             if value:</span>
<span class="c1">#                 for sub_value in value:</span>
<span class="c1">#                     if &#39;primary&#39; in sub_value:</span>
<span class="c1">#                         primary_slots += sub_value[&#39;primary&#39;]</span>
<span class="c1">#                     if &#39;revision&#39; in sub_value:</span>
<span class="c1">#                         revision_slots += sub_value[&#39;revision&#39;]</span>
<span class="c1">#         return [primary_slots, revision_slots]</span>

<span class="c1">#     def week_schedule(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         samples a weekly dictionary of theatres, sessions, and surgeries from create_schedule()</span>
<span class="c1">#         counts daily number or primary and revision surgeries needed using daily_counts()</span>
<span class="c1">#         and converts to a dataframe</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         week_sched = pd.DataFrame(columns=[&#39;Primary_slots&#39;, &#39;Revision_slots&#39;])</span>
<span class="c1">#         day_data = self.create_schedule(self.weekday, self.sessions_per_weekday_list,</span>
<span class="c1">#                                    self.allocation, self.theatres_per_weekday)</span>
<span class="c1">#         for key, value in day_data.items():</span>
<span class="c1">#             week_sched.loc[key] = self.daily_counts(value)</span>
<span class="c1">#         week_sched = week_sched.reset_index()</span>
<span class="c1">#         week_sched.rename(columns = {&#39;index&#39;:&#39;Day&#39;}, inplace = True)</span>
<span class="c1">#         return week_sched</span>

<span class="c1">#     def theatre_capacity(self):</span>
<span class="c1">#         length_sched = int(round(2*(DEFAULT_WARM_UP_PERIOD+DEFAULT_RESULTS_COLLECTION_PERIOD)/7, 0))</span>

<span class="c1">#         DEFAULT_SCHEDULE_AVAIL = pd.DataFrame()</span>
<span class="c1">#         for week in range(length_sched):</span>
<span class="c1">#             single_random_week = self.week_schedule()</span>
<span class="c1">#             DEFAULT_SCHEDULE_AVAIL = pd.concat([DEFAULT_SCHEDULE_AVAIL, single_random_week],axis=0)</span>
<span class="c1">#         return DEFAULT_SCHEDULE_AVAIL.reset_index()</span>

<span class="c1"># class Save:</span>
<span class="c1">#     schedule = Schedule()</span>
<span class="c1">#     def __init__(self, schedule):</span>
<span class="c1">#         self.schedule = schedule</span>
    
<span class="c1">#     schedule_avail_weekend = schedule.theatre_capacity()</span>
<span class="c1">#     print(schedule_avail_weekend.head(7))</span>
<span class="c1">#     schedule_avail_weekend.to_csv(&#39;Test_data/schedule_seven_days.csv&#39;)</span>

<span class="n">new_schedule</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;Test_data/schedule_seven_days.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_scenario_dict</span><span class="p">():</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a dictionary object of scenario attributes from a dataframe</span>
<span class="sd">    of defined scenarios</span>
<span class="sd">   </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict:</span>
<span class="sd">    Contains the scenario attributes for the model</span>
<span class="sd">    df:</span>
<span class="sd">    Contains a table of scenarios</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1">#values for scenario df</span>
    <span class="n">scenario</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">)]</span>
    <span class="n">beds_seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">primary_hip_mean_los</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PRIMARY_HIP_MEAN_LOS</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PRIMARY_HIP_MEAN_LOS</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">18</span>
    <span class="n">primary_knee_mean_los</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PRIMARY_KNEE_MEAN_LOS</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PRIMARY_KNEE_MEAN_LOS</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">18</span>
    <span class="n">revision_hip_mean_los</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_REVISION_HIP_MEAN_LOS</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_REVISION_HIP_MEAN_LOS</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">18</span>
    <span class="n">revision_knee_mean_los</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_REVISION_KNEE_MEAN_LOS</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_REVISION_KNEE_MEAN_LOS</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">18</span>    
    <span class="n">unicompart_knee_mean_los</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_UNICOMPART_KNEE_MEAN_LOS</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_UNICOMPART_KNEE_MEAN_LOS</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">18</span>
    <span class="n">delay_post_los_mean</span> <span class="o">=</span> <span class="p">[</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_DELAY_POST_LOS_MEAN</span><span class="p">]</span><span class="o">*</span><span class="mi">36</span>
    <span class="n">prob_ward_delay</span> <span class="o">=</span> <span class="p">(([</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PROB_WARD_DELAY</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PROB_WARD_DELAY</span><span class="o">*</span><span class="mf">0.25</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="p">)</span> <span class="o">+</span> 
                       <span class="p">([</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PROB_WARD_DELAY</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_PROB_WARD_DELAY</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="p">))</span>

    <span class="c1">#create df of scenarios</span>
    <span class="n">values_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;scenario&#39;</span><span class="p">:</span><span class="n">scenario</span><span class="p">,</span>
                          <span class="s1">&#39;n_beds&#39;</span><span class="p">:</span> <span class="n">beds_seq</span><span class="p">,</span>
                          <span class="s1">&#39;primary_hip_mean_los&#39;</span><span class="p">:</span> <span class="n">primary_hip_mean_los</span><span class="p">,</span>
                          <span class="s1">&#39;primary_knee_mean_los&#39;</span><span class="p">:</span> <span class="n">primary_knee_mean_los</span><span class="p">,</span>
                          <span class="s1">&#39;revision_hip_mean_los&#39;</span><span class="p">:</span> <span class="n">revision_hip_mean_los</span><span class="p">,</span>
                          <span class="s1">&#39;revision_knee_mean_los&#39;</span><span class="p">:</span> <span class="n">revision_knee_mean_los</span><span class="p">,</span>
                          <span class="s1">&#39;unicompart_knee_mean_los&#39;</span> <span class="p">:</span> <span class="n">unicompart_knee_mean_los</span><span class="p">,</span>
                          <span class="s1">&#39;delay_post_los_mean&#39;</span><span class="p">:</span> <span class="n">delay_post_los_mean</span><span class="p">,</span>
                          <span class="s1">&#39;prob_ward_delay&#39;</span><span class="p">:</span> <span class="n">prob_ward_delay</span><span class="p">})</span>
    
    <span class="c1">#create dict of scenarios</span>
    <span class="n">scenario_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;n_beds&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_beds&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;primary_hip_mean_los&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;primary_hip_mean_los&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;primary_knee_mean_los&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;primary_knee_mean_los&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;revision_hip_mean_los&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;revision_hip_mean_los&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;revision_knee_mean_los&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;revision_knee_mean_los&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;unicompart_knee_mean_los&#39;</span> <span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;unicompart_knee_mean_los&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;delay_post_los_mean&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;delay_post_los_mean&#39;</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;prob_ward_delay&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;prob_ward_delay&#39;</span><span class="p">]}]</span>
        <span class="n">scenario_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">return</span><span class="p">(</span><span class="n">values_df</span><span class="p">,</span> <span class="n">scenario_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_scenarios_2k</span><span class="p">(</span><span class="n">dict_s</span><span class="p">,</span> <span class="n">new_schedule</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create dictionary of scenario objects using attribute dictionary</span>
<span class="sd">    A set of baseline schedule</span>
<span class="sd">    A set of new_schedule</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">    Contains the scenarios for the model</span>
<span class="sd">  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#schedule = md.Schedule()</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">schedule</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Schedule</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_s</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">sub_value</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">sub_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_value</span>
        <span class="c1">#for each scenario, create a Scenario object with baseline schedule</span>
        <span class="n">scenarios</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Scenario</span><span class="p">(</span><span class="n">schedule</span><span class="p">,</span> <span class="n">schedule_avail</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
    
        <span class="c1"># for each scenario, create a Scenario object with new schedule</span>
        <span class="n">scenarios</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_new_schedule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Scenario</span><span class="p">(</span><span class="n">schedule</span><span class="p">,</span> <span class="n">schedule_avail</span> <span class="o">=</span> <span class="n">new_schedule</span><span class="p">,</span> <span class="o">**</span><span class="n">attributes</span><span class="p">)</span>
   
    <span class="k">return</span> <span class="n">scenarios</span>


<span class="k">def</span> <span class="nf">run_scenario_analysis_2k</span><span class="p">(</span><span class="n">scenarios</span><span class="p">,</span> <span class="n">rc_period</span><span class="p">,</span> <span class="n">n_reps</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run each of the scenarios for a specified results</span>
<span class="sd">    collection period and replications.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    a) summary results table</span>
<span class="sd">    b) Results per day</span>
<span class="sd">    c) Patient-level results</span>
<span class="sd">       </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    scenarios: dict</span>
<span class="sd">        dictionary of Scenario objects</span>
<span class="sd">        </span>
<span class="sd">    rc_period: float</span>
<span class="sd">        model run length</span>
<span class="sd">        </span>
<span class="sd">    n_rep: int</span>
<span class="sd">        Number of replications</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Scenario Analysis&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No. Scenario: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scenarios</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Replications: </span><span class="si">{</span><span class="n">n_reps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">scenario_results_summ</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">scenario_results_day</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">scenario_results_ppat</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">scenario_results_rpat</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running </span><span class="si">{</span><span class="n">sc_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
        
        <span class="n">replications</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">multiple_reps</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> 
                        <span class="n">results_collection</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="o">+</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_WARM_UP_PERIOD</span><span class="p">,</span> 
                        <span class="n">n_reps</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_RUNS</span><span class="p">)</span>
        
        <span class="n">replications_summ</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">replications_day</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">replications_ppat</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">replications_rpat</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        
                    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#save the results</span>
        <span class="n">scenario_results_summ</span><span class="p">[</span><span class="n">sc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replications_summ</span>
        <span class="n">scenario_results_day</span><span class="p">[</span><span class="n">sc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replications_day</span>
        <span class="n">scenario_results_ppat</span><span class="p">[</span><span class="n">sc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replications_ppat</span>
        <span class="n">scenario_results_rpat</span><span class="p">[</span><span class="n">sc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replications_rpat</span>
    
         
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Scenario analysis complete.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">scenario_results_summ</span><span class="p">,</span> <span class="n">scenario_results_day</span><span class="p">,</span><span class="n">scenario_results_ppat</span><span class="p">,</span><span class="n">scenario_results_rpat</span><span class="p">)</span>

<span class="c1">#get the scenario df and dict</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">get_scenario_dict</span><span class="p">()</span>
<span class="n">scenario_df</span><span class="p">,</span> <span class="n">scenario_dict</span> <span class="o">=</span> <span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">#convert to scenarios</span>
<span class="c1">#new_sched = pd.read_csv(&#39;schedule_weekends.csv&#39;)</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="n">get_scenarios_2k</span><span class="p">(</span><span class="n">scenario_dict</span><span class="p">,</span> <span class="n">new_schedule</span><span class="p">)</span>

<span class="c1">#run the scenario analysis</span>
<span class="n">scenario_results_2k</span> <span class="o">=</span> <span class="n">run_scenario_analysis_2k</span><span class="p">(</span><span class="n">scenarios</span><span class="p">,</span> 
                                         <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="o">+</span><span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_WARM_UP_PERIOD</span><span class="p">,</span>
                                         <span class="n">n_reps</span><span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_RUNS</span><span class="p">)</span><span class="c1">#number_of_runs</span>

<span class="n">scenario_results_patients_2k</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">scenario_results_2k</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">key</span><span class="p">],</span> <span class="n">scenario_results_2k</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">key</span><span class="p">]],</span> 
                              <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">scenario_results_2k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scenario Analysis
No. Scenario: 72
Replications: 50
Running 1.0 =&gt; done.

Running 1.0_new_schedule =&gt; done.

Running 2.0 =&gt; done.

Running 2.0_new_schedule =&gt; done.

Running 3.0 =&gt; done.

Running 3.0_new_schedule =&gt; done.

Running 4.0 =&gt; done.

Running 4.0_new_schedule =&gt; done.

Running 5.0 =&gt; done.

Running 5.0_new_schedule =&gt; done.

Running 6.0 =&gt; done.

Running 6.0_new_schedule =&gt; done.

Running 7.0 =&gt; done.

Running 7.0_new_schedule =&gt; done.

Running 8.0 =&gt; done.

Running 8.0_new_schedule =&gt; done.

Running 9.0 =&gt; done.

Running 9.0_new_schedule =&gt; done.

Running 10.0 =&gt; done.

Running 10.0_new_schedule =&gt; done.

Running 11.0 =&gt; done.

Running 11.0_new_schedule =&gt; done.

Running 12.0 =&gt; done.

Running 12.0_new_schedule =&gt; done.

Running 13.0 =&gt; done.

Running 13.0_new_schedule =&gt; done.

Running 14.0 =&gt; done.

Running 14.0_new_schedule =&gt; done.

Running 15.0 =&gt; done.

Running 15.0_new_schedule =&gt; done.

Running 16.0 =&gt; done.

Running 16.0_new_schedule =&gt; done.

Running 17.0 =&gt; done.

Running 17.0_new_schedule =&gt; done.

Running 18.0 =&gt; done.

Running 18.0_new_schedule =&gt; done.

Running 19.0 =&gt; done.

Running 19.0_new_schedule =&gt; done.

Running 20.0 =&gt; done.

Running 20.0_new_schedule =&gt; done.

Running 21.0 =&gt; done.

Running 21.0_new_schedule =&gt; done.

Running 22.0 =&gt; done.

Running 22.0_new_schedule =&gt; done.

Running 23.0 =&gt; done.

Running 23.0_new_schedule =&gt; done.

Running 24.0 =&gt; done.

Running 24.0_new_schedule =&gt; done.

Running 25.0 =&gt; done.

Running 25.0_new_schedule =&gt; done.

Running 26.0 =&gt; done.

Running 26.0_new_schedule =&gt; done.

Running 27.0 =&gt; done.

Running 27.0_new_schedule =&gt; done.

Running 28.0 =&gt; done.

Running 28.0_new_schedule =&gt; done.

Running 29.0 =&gt; done.

Running 29.0_new_schedule =&gt; done.

Running 30.0 =&gt; done.

Running 30.0_new_schedule =&gt; done.

Running 31.0 =&gt; done.

Running 31.0_new_schedule =&gt; done.

Running 32.0 =&gt; done.

Running 32.0_new_schedule =&gt; done.

Running 33.0 =&gt; done.

Running 33.0_new_schedule =&gt; done.

Running 34.0 =&gt; done.

Running 34.0_new_schedule =&gt; done.

Running 35.0 =&gt; done.

Running 35.0_new_schedule =&gt; done.

Running 36.0 =&gt; done.

Running 36.0_new_schedule =&gt; done.

Scenario analysis complete.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save table of scenarios</span>
<span class="n">scenario_df</span> <span class="o">=</span> <span class="n">scenario_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scenario_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;output/scenario_df.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="save-results">
<h1>SAVE RESULTS<a class="headerlink" href="#save-results" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>Save scenario table (72 scenarios = range of capacity *9, los *2, delays *2, schedule *2)</p></li>
</ul>
<section id="scenario-output-description">
<h2>Scenario output description<a class="headerlink" href="#scenario-output-description" title="Permalink to this headline">#</a></h2>
<p>Each capacity on the x-axis
With schedule and schedule_new in separate columns</p>
<p>Each los and delay scenario (4) for each capacity (and sched) with:</p>
<ul class="simple">
<li><p>mean  utilisation</p></li>
<li><p>mean total thruput</p></li>
<li><p>mean total lost slots</p></li>
</ul>
</section>
<section id="throughput">
<h2>Throughput<a class="headerlink" href="#throughput" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scenario_results_patients_2k: patient-level results </span>

<span class="k">def</span> <span class="nf">mean_weekly_thruput_per_procedure</span><span class="p">(</span><span class="n">scenario_results_patients_2k</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Takes patient level data as inputs</span>
<span class="sd">    Remove &#39;lost slots&#39; so only patients with a stay are included</span>
<span class="sd">    Remove warm-up period</span>
<span class="sd">    Summarises by surgical type</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">replications</span> <span class="ow">in</span> <span class="n">scenario_results_patients_2k</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="c1">#for total throughput: select only those who are allocated a bed</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="n">replications</span><span class="p">[</span><span class="s1">&#39;lost slots&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="n">replications</span><span class="p">[</span><span class="s1">&#39;Day&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_WARM_UP_PERIOD</span><span class="p">]</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[[</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span><span class="s1">&#39;surgery type&#39;</span><span class="p">,</span> <span class="s1">&#39;depart&#39;</span><span class="p">]]</span>

        <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">patient_summary</span><span class="p">,</span> <span class="n">replications</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span><span class="s1">&#39;weekday&#39;</span><span class="p">])</span>\
                                         <span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1">#patient_summary_ci = pd.concat([patient_summary, replications.groupby([&#39;Day&#39;,&#39;weekday&#39;,&#39;surgery type&#39;])\</span>
         <span class="c1">#                                [&#39;surgery type&#39;].agg(&#39;mean&#39;,&#39;count&#39;,&#39;std&#39;)],axis=1)</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_name</span><span class="p">)</span>

    <span class="n">patient_summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;weekday&#39;</span><span class="p">:</span><span class="s1">&#39;Counts&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1">#print(patient_summary_ci.head())</span>

    <span class="c1"># patient_summary.rename(columns = {&#39;surgery type&#39;:&#39;Counts&#39;}, inplace = True)</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">patient_summary</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Counts</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Counts&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_RUNS</span><span class="p">))</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">patient_summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">patient_summary</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">patient_summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;level_1&#39;</span><span class="p">:</span><span class="s1">&#39;weekday&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">patient_summary</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;weekday&#39;</span><span class="p">])[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">patient_summary</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> 

<span class="c1"># run function and save weekly surgical throughput per procedure to csv</span>
<span class="n">weekly_thru_procedure</span> <span class="o">=</span> <span class="n">mean_weekly_thruput_per_procedure</span><span class="p">(</span><span class="n">scenario_results_patients_2k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put in long format for plotting</span>
<span class="k">def</span> <span class="nf">long_data</span><span class="p">(</span><span class="n">weekly_thru_procedure</span><span class="p">,</span> <span class="n">measure</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Take outputs of weekly and summarise per day into long format</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># create df of means and remove weekday</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">weekly_thru_procedure</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">means_thru</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Means per day&#39;</span><span class="p">:</span> <span class="n">means</span><span class="p">})</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1">#separate schedule categories and number of beds into separate columns</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;Schedule &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;_new_schedule&#39;</span><span class="p">),</span> 
                                       <span class="s1">&#39; Baseline + weekends&#39;</span><span class="p">,</span> <span class="s1">&#39; Baseline&#39;</span><span class="p">)</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;Beds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="c1"># extract scenario number</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_new_value</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        function to allocate scenario for los and prop delayed</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">los</span> <span class="o">=</span> <span class="s1">&#39;low&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">los</span> <span class="o">=</span> <span class="s1">&#39;high&#39;</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="s1">&#39;prop_high&#39;</span> <span class="k">if</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;prop_low&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="s1">&#39;prop_high&#39;</span> <span class="k">if</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;prop_low&#39;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">los</span><span class="si">}</span><span class="s2">_los, </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Apply the function to the &#39;index&#39; column to create a new column</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;scenarios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;index_int&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_new_value</span><span class="p">)</span>

    <span class="c1"># add a &#39;measure column&#39; for plotting</span>
    <span class="n">means_thru</span><span class="p">[</span><span class="s1">&#39;Measure &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">measure</span><span class="p">]</span><span class="o">*</span><span class="mi">72</span>
    
    <span class="k">return</span> <span class="n">means_thru</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">long_thru_data</span> <span class="o">=</span> <span class="n">long_data</span><span class="p">(</span><span class="n">weekly_thru_procedure</span><span class="p">,</span> <span class="s1">&#39; Throughput&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="utilisation">
<h2>Utilisation<a class="headerlink" href="#utilisation" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">daily_utilisation</span><span class="p">(</span><span class="n">scenario_results</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Weekly audit results for utilisation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">weekly_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">replications</span> <span class="ow">in</span> <span class="n">scenario_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">weekly_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">weekly_summary</span><span class="p">,</span> <span class="n">replications</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;weekday&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_name</span><span class="p">)</span>

    <span class="n">values</span> <span class="o">=</span> <span class="n">weekly_summary</span><span class="p">[</span><span class="s1">&#39;bed_utilisation&#39;</span><span class="p">]</span>
    <span class="n">values</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    
    <span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># run function and save to csv</span>
<span class="n">weekly_util</span> <span class="o">=</span> <span class="n">daily_utilisation</span><span class="p">(</span><span class="n">scenario_results_2k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">long_util_data</span> <span class="o">=</span> <span class="n">long_data</span><span class="p">(</span><span class="n">weekly_util</span><span class="p">,</span> <span class="s1">&#39; Utilisation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>Means per day</th>
      <th>Schedule</th>
      <th>Beds</th>
      <th>index_int</th>
      <th>scenarios</th>
      <th>Measure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.904667</td>
      <td>Baseline</td>
      <td>30</td>
      <td>1.0</td>
      <td>high_los, prop_high</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0_new_schedule</td>
      <td>0.944581</td>
      <td>Baseline + weekends</td>
      <td>30</td>
      <td>1.0</td>
      <td>high_los, prop_high</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>0.368588</td>
      <td>Baseline</td>
      <td>35</td>
      <td>2.0</td>
      <td>low_los, prop_low</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0_new_schedule</td>
      <td>0.498669</td>
      <td>Baseline + weekends</td>
      <td>35</td>
      <td>2.0</td>
      <td>low_los, prop_low</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.0</td>
      <td>0.895707</td>
      <td>Baseline</td>
      <td>40</td>
      <td>3.0</td>
      <td>high_los, prop_high</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3.0_new_schedule</td>
      <td>0.941236</td>
      <td>Baseline + weekends</td>
      <td>40</td>
      <td>3.0</td>
      <td>high_los, prop_high</td>
      <td>Utilisation</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4.0</td>
      <td>0.284813</td>
      <td>Baseline</td>
      <td>45</td>
      <td>4.0</td>
      <td>low_los, prop_low</td>
      <td>Utilisation</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="lost-slots">
<h2>Lost slots<a class="headerlink" href="#lost-slots" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">patient_scenarios</span><span class="p">(</span><span class="n">scenario_results</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes patient level results for each performance measure by scenario</span>
<span class="sd">    Selects lost slots, summarise across runs, </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">replications</span> <span class="ow">in</span> <span class="n">scenario_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
        <span class="n">replications</span> <span class="o">=</span> <span class="n">replications</span><span class="p">[</span><span class="n">replications</span><span class="p">[</span><span class="s1">&#39;Day&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_WARM_UP_PERIOD</span><span class="p">]</span>
        <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">patient_summary</span><span class="p">,</span> <span class="n">replications</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;weekday&#39;</span><span class="p">])</span>\
                                     <span class="p">[</span><span class="s1">&#39;lost slots&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_name</span><span class="p">)</span> 
        
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">patient_summary</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="n">md</span><span class="o">.</span><span class="n">DEFAULT_NUMBER_OF_RUNS</span><span class="p">)</span>
    <span class="c1">#columns = list(map(&#39;_&#39;.join, zip(columns, patient_summary)))</span>
    <span class="n">patient_summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="n">patient_summary</span> <span class="o">=</span> <span class="n">patient_summary</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">patient_summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span><span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;level_1&#39;</span><span class="p">:</span><span class="s1">&#39;weekday&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">patient_summary</span><span class="p">)</span>

<span class="n">patient_summary</span> <span class="o">=</span> <span class="n">patient_scenarios</span><span class="p">(</span><span class="n">scenario_results_patients_2k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lost_slots</span><span class="p">(</span><span class="n">patient_summary</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes output of previous function</span>
<span class="sd">    Deals with 0-day arrivals</span>
<span class="sd">    plot lost slots per scenario per weekday</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patient_summ</span> <span class="o">=</span> <span class="p">(</span><span class="n">patient_summary</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Day&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">patient_summary</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">patient_summary</span><span class="o">.</span><span class="n">Day</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
    <span class="n">shortseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)))</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_summ</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span>
    <span class="c1"># create total sequence and flatten array list into list of elements</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">((</span><span class="n">shortseq</span><span class="p">),</span><span class="n">length</span><span class="p">)])</span>
    <span class="n">flat_seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">sequence</span><span class="p">))</span>
    <span class="c1"># truncate to correct length and save to column</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="n">flat_seq</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_summ</span><span class="p">)]</span>
    <span class="n">patient_summ</span><span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span> 
    <span class="n">patient_summ</span> <span class="o">=</span> <span class="n">patient_summ</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1">#patient_summ = patient_summ[patient_summ[&quot;Day&quot;] &gt; DEFAULT_WARM_UP_PERIOD]    </span>
    <span class="n">patient_summ</span> <span class="o">=</span> <span class="n">patient_summ</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;weekday&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">patient_summ</span> <span class="o">=</span> <span class="n">patient_summ</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">patient_summ</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;Day&#39;</span><span class="p">]</span>
    <span class="c1">#day_map = {0: &#39;Mon&#39;, 1: &#39;Tues&#39;, 2: &#39;Weds&#39;, 3: &#39;Thurs&#39;, 4: &#39;Fri&#39;, 5: &#39;Sat&#39;, 6: &#39;Sun&#39;}</span>
    <span class="c1">#patient_summ[&#39;weekday&#39;] = patient_summ[&#39;weekday&#39;].map(day_map)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">patient_summ</span><span class="p">)</span>

<span class="n">lost_slots</span> <span class="o">=</span> <span class="n">lost_slots</span><span class="p">(</span><span class="n">patient_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">long_lostslots_data</span> <span class="o">=</span> <span class="n">long_data</span><span class="p">(</span><span class="n">lost_slots</span><span class="p">,</span> <span class="s1">&#39; Lost slots&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">means_output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">long_thru_data</span><span class="p">,</span> <span class="n">long_util_data</span><span class="p">,</span> <span class="n">long_lostslots_data</span><span class="p">])</span>
<span class="n">means_output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;output/means_output.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">means_output</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">means_output</span><span class="o">.</span><span class="n">Beds</span><span class="p">,</span> 
             <span class="n">y</span><span class="o">=</span><span class="n">means_output</span><span class="p">[</span><span class="s1">&#39;Means per day&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">means_output</span><span class="o">.</span><span class="n">scenarios</span><span class="p">,</span> 
             <span class="n">facet_row</span><span class="o">=</span><span class="n">means_output</span><span class="p">[</span><span class="s1">&#39;Measure &#39;</span><span class="p">],</span> <span class="n">facet_col</span><span class="o">=</span><span class="n">means_output</span><span class="p">[</span><span class="s1">&#39;Schedule &#39;</span><span class="p">],</span> 
             <span class="n">barmode</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis2</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis3</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y3&#39;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis4</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y3&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis5</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y5&#39;</span>
<span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis6</span><span class="o">.</span><span class="n">matches</span> <span class="o">=</span> <span class="s1">&#39;y5&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s1">&#39;output/scenarios_paper_fig.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>                            <div id="88159b9a-ad38-4e8d-b1a3-b22751779cc3" class="plotly-graph-div" style="height:800px; width:1200px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("88159b9a-ad38-4e8d-b1a3-b22751779cc3")) {                    Plotly.newPlot(                        "88159b9a-ad38-4e8d-b1a3-b22751779cc3",                        [{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Throughput<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":true,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x5","y":[5.1875873015873015,6.800317460317459,8.177873015873017,9.521777777777777,10.776984126984129,6.030571428571429,7.548984126984126,8.852031746031747,10.151809523809524],"yaxis":"y5","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Throughput<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x6","y":[5.142,6.83311111111111,8.434984126984126,9.974634920634921,11.377999999999998,5.998507936507936,7.604285714285714,9.107714285714286,10.676888888888888],"yaxis":"y6","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Utilisation<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x3","y":[0.9046666666666667,0.8957071428571429,0.87652,0.8509619047619048,0.824342857142857,0.9010857142857144,0.888431746031746,0.8669090909090909,0.8437538461538461],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Utilisation<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x4","y":[0.9445809523809525,0.9412357142857143,0.9373885714285715,0.9315761904761904,0.9236489795918369,0.9428244897959184,0.9400571428571429,0.933412987012987,0.9274241758241759],"yaxis":"y4","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Lost slots<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x","y":[6.163174603174603,4.69670634920635,3.227738095238095,1.9285714285714286,0.8073015873015874,5.378452380952381,3.946904761904762,2.539484126984127,1.2460317460317463],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_high<br>Measure = Lost slots<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_high","marker":{"color":"#636efa","pattern":{"shape":""}},"name":"high_los, prop_high","offsetgroup":"high_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x2","y":[10.35531746031746,8.530515873015872,6.806468253968254,5.146428571428571,3.6282539682539685,9.432976190476191,7.699761904761906,6.079722222222222,4.385555555555556],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Throughput<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":true,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x5","y":[11.350793650793651,11.092063492063492,11.43968253968254,11.195238095238095,11.375650793650793,11.314285714285715,11.711111111111112,11.212698412698414,11.657142857142858],"yaxis":"y5","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Throughput<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x6","y":[14.741873015873017,14.75079365079365,14.75079365079365,14.75079365079365,14.64679365079365,14.75079365079365,14.75079365079365,14.75079365079365,14.75079365079365],"yaxis":"y6","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Utilisation<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x3","y":[0.3685877551020408,0.2848126984126984,0.23588571428571425,0.1994901098901099,0.4332285714285714,0.32680000000000003,0.26074285714285717,0.21206190476190476,0.1866204081632653],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Utilisation<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x4","y":[0.49866938775510206,0.3852190476190476,0.3149662337662338,0.26454065934065935,0.5782476190476191,0.43409285714285717,0.34452000000000005,0.29048095238095234,0.25],"yaxis":"y4","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Lost slots<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x","y":[0.0,0.0,0.0,0.0,0.0034920634920634916,0.0,0.0,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_low<br>Measure = Lost slots<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_low","marker":{"color":"#EF553B","pattern":{"shape":""}},"name":"low_los, prop_low","offsetgroup":"low_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x2","y":[0.009523809523809523,0.0,0.0,0.0,0.11210317460317461,0.0,0.0,0.0,0.0],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Throughput<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":true,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x5","y":[5.806920634920636,7.450507936507937,8.856984126984127,10.280285714285714,11.234666666666667,6.661714285714284,8.302349206349207,9.775238095238095,10.96136507936508],"yaxis":"y5","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Throughput<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x6","y":[5.924317460317461,7.702126984126984,9.430444444444445,11.06622222222222,12.585555555555556,6.81526984126984,8.618571428571427,10.263174603174603,11.871936507936509],"yaxis":"y6","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Utilisation<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x3","y":[0.8933809523809524,0.8738071428571428,0.8484914285714287,0.8154666666666667,0.7593836734693877,0.880791836734694,0.8618793650793651,0.8383220779220779,0.7968747252747254],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Utilisation<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x4","y":[0.9382476190476191,0.9317571428571428,0.9255542857142858,0.9161714285714284,0.9014448979591837,0.9336081632653062,0.9291619047619049,0.9202701298701299,0.90829010989011],"yaxis":"y4","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Lost slots<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x","y":[5.856507936507937,3.9692460317460316,2.441904761904762,1.1593650793650794,0.22603174603174603,4.668809523809523,3.1567857142857143,1.7307936507936508,0.58],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=high_los, prop_low<br>Measure = Lost slots<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"high_los, prop_low","marker":{"color":"#00cc96","pattern":{"shape":""}},"name":"high_los, prop_low","offsetgroup":"high_los, prop_low","orientation":"v","showlegend":false,"textposition":"auto","x":[30,40,50,60,70,35,45,55,65],"xaxis":"x2","y":[9.513769841269843,7.5928571428571425,5.728849206349206,3.964523809523809,2.3267857142857147,8.552539682539683,6.604642857142857,4.8307142857142855,3.0993253968253964],"yaxis":"y2","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Throughput<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":true,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x5","y":[11.170126984126984,11.355269841269841,11.250793650793652,11.312698412698413,10.577238095238096,11.443809523809524,11.238095238095239,11.412698412698413,11.517460317460317],"yaxis":"y5","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Throughput<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x6","y":[13.134539682539682,14.634857142857143,14.74831746031746,14.75079365079365,11.718793650793653,14.169492063492061,14.738984126984127,14.75047619047619,14.75079365079365],"yaxis":"y6","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Utilisation<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x3","y":[0.6454530612244898,0.4922412698412698,0.4067792207792208,0.3427736263736264,0.7200285714285714,0.5552142857142857,0.4457428571428571,0.3727095238095238,0.3213061224489796],"yaxis":"y3","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Utilisation<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x4","y":[0.8152163265306123,0.6735555555555556,0.557812987012987,0.4588395604395604,0.8585238095238096,0.7502571428571427,0.5987485714285714,0.4986761904761905,0.43281224489795916],"yaxis":"y4","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Lost slots<br>Schedule = Baseline<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x","y":[0.15785714285714286,0.00031746031746031746,0.0,0.0,0.6944047619047619,0.02011904761904762,0.0,0.0,0.0],"yaxis":"y","type":"bar"},{"alignmentgroup":"True","hovertemplate":"scenarios=low_los, prop_high<br>Measure = Lost slots<br>Schedule = Baseline + weekends<br>Beds=%{x}<br>Means per day=%{y}<extra></extra>","legendgroup":"low_los, prop_high","marker":{"color":"#ab63fa","pattern":{"shape":""}},"name":"low_los, prop_high","offsetgroup":"low_los, prop_high","orientation":"v","showlegend":false,"textposition":"auto","x":[35,45,55,65,30,40,50,60,70],"xaxis":"x2","y":[1.741468253968254,0.12499999999999999,0.0025396825396825397,0.0,3.2609920634920635,0.6248412698412699,0.01265873015873016,0.00031746031746031746,0.0],"yaxis":"y2","type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,0.48],"title":{"text":"Beds"}},"yaxis":{"anchor":"x","domain":[0.0,0.3133333333333333],"title":{"text":"Means per day"},"matches":"y"},"xaxis2":{"anchor":"y2","domain":[0.5,0.98],"matches":"x","title":{"text":"Beds"}},"yaxis2":{"anchor":"x2","domain":[0.0,0.3133333333333333],"matches":"y","showticklabels":false},"xaxis3":{"anchor":"y3","domain":[0.0,0.48],"matches":"x","showticklabels":false},"yaxis3":{"anchor":"x3","domain":[0.34333333333333327,0.6566666666666665],"matches":"y3","title":{"text":"Means per day"}},"xaxis4":{"anchor":"y4","domain":[0.5,0.98],"matches":"x","showticklabels":false},"yaxis4":{"anchor":"x4","domain":[0.34333333333333327,0.6566666666666665],"matches":"y3","showticklabels":false},"xaxis5":{"anchor":"y5","domain":[0.0,0.48],"matches":"x","showticklabels":false},"yaxis5":{"anchor":"x5","domain":[0.6866666666666665,0.9999999999999998],"matches":"y5","title":{"text":"Means per day"}},"xaxis6":{"anchor":"y6","domain":[0.5,0.98],"matches":"x","showticklabels":false},"yaxis6":{"anchor":"x6","domain":[0.6866666666666665,0.9999999999999998],"matches":"y5","showticklabels":false},"annotations":[{"font":{},"showarrow":false,"text":"Schedule = Baseline","x":0.24,"xanchor":"center","xref":"paper","y":0.9999999999999998,"yanchor":"bottom","yref":"paper"},{"font":{},"showarrow":false,"text":"Schedule = Baseline + weekends","x":0.74,"xanchor":"center","xref":"paper","y":0.9999999999999998,"yanchor":"bottom","yref":"paper"},{"font":{},"showarrow":false,"text":"Measure = Lost slots","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.15666666666666665,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"Measure = Utilisation","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.4999999999999999,"yanchor":"middle","yref":"paper"},{"font":{},"showarrow":false,"text":"Measure = Throughput","textangle":90,"x":0.98,"xanchor":"left","xref":"paper","y":0.8433333333333332,"yanchor":"middle","yref":"paper"}],"legend":{"title":{"text":"scenarios"},"tracegroupgap":0},"margin":{"t":60},"barmode":"group","height":800,"width":1200},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('88159b9a-ad38-4e8d-b1a3-b22751779cc3');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./HEP_notebooks/01_model"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="02_Scenario_testing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Scenario Testing</p>
      </div>
    </a>
    <a class="right-next"
       href="04_HEP_fit_dists.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fitting LoS distributions for HEP</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Scenario analysis for BMJ Open paper</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenarios">Scenarios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-schedule-with-weekend-activity-for-scenarios">Create schedule with weekend activity for scenarios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#save-results">SAVE RESULTS</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scenario-output-description">Scenario output description</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#throughput">Throughput</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lost-slots">Lost slots</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alison Harper, Thomas Monks, Martin Pitt
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>